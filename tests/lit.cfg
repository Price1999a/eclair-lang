import subprocess
import lit.formats
from lit.llvm.subst import ToolSubst, FindTool

config.name = "Eclair integration tests"
config.test_format = lit.formats.ShTest(False)  # 1 test per file
config.suffixes = ['.eclair']
config.excludes = ['Test']  # Don't look in the directory for Haskell tests

test_dir = os.path.dirname(__file__)
config.test_source_root = test_dir
config.test_exec_root = test_dir

analysis_dir = test_dir + '/../cbits/'
config.environment['DATALOG_DIR'] = analysis_dir
config.environment['ECLAIR_USE_COLOR'] = '0'

# NOTE: need to run cabal build if you're making changes to the compiler
# before running tests
eclair = subprocess.run(['cabal', 'list-bin', 'eclair'], capture_output=True).stdout.decode().rstrip('\n')
config.substitutions.append(
  ('%eclair', eclair)
)
