import subprocess
import lit.formats

config.name = "Eclair integration tests"
config.test_format = lit.formats.ShTest(False)  # 1 test per file
config.suffixes = ['.eclair']
config.excludes = ['Test']  # Don't look in the directory for Haskell tests

test_dir = os.path.dirname(__file__)
config.test_source_root = test_dir
config.test_exec_root = test_dir

analysis_dir = test_dir + '/../cbits/'
config.environment['DATALOG_DIR'] = analysis_dir
config.environment['ECLAIR_USE_COLOR'] = '0'

config.substitutions.append(('%clang', 'clang'))

try:
  subprocess.check_output(['which', 'eclair'])
  config.substitutions.append(('%eclair', 'eclair'))
except:
  eclair = subprocess.check_output(['cabal', 'list-bin', 'eclair']).decode().rstrip('\n')
  config.substitutions.append(('%eclair', eclair))
