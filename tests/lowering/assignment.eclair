// RUN: split-file %s %t

// RUN: %eclair compile --emit ra %t/program.eclair > %t/actual.out
// RUN: diff %t/expected.out %t/actual.out

//--- program.eclair
@def fact1(u32, u32).
@def fact2(u32, u32).

fact2(x, 1) :-
  z = x,
  fact1(x, z),
  y = 123,
  fact1(y, x).

fact2(x, y) :-
  123 = x,
  fact1(y, x).

//--- expected.out
search fact1 as fact10 do
  if 123 = fact10[1] do
    project (fact10[1], fact10[0]) into fact2
search fact1 as fact10 do
  search fact1 as fact11 where (fact11[1] = fact10[0]) do
    if fact10[1] = fact10[0] do
      if fact11[0] = 123 do
        project (fact10[0], 1) into fact2
